<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daniel</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --font: 'JetBrains Mono', monospace;
    --ease: cubic-bezier(0.16, 1, 0.3, 1);
  }

  [data-theme="dark"] {
    --bg: #0a0a0a;
    --fg: #d4d4d4;
    --muted: #525252;
    --dim: #3a3a3a;
    --border: #1f1f1f;
    --accent: #a0a0a0;
    --hover: #ffffff;
    --panel-bg: #111111;
    --panel-border: #1e1e1e;
    --node-stroke: #3a3a3a;
    --node-text: #808080;
    --line-color: #2a2a2a;
    --line-dash: #1e1e1e;
    --center-fill: #e85d2a;
    --year-color: #333;
    --item-hover: #181818;
  }

  [data-theme="light"] {
    --bg: #f0ede8;
    --fg: #1a1a1a;
    --muted: #8a8a8a;
    --dim: #b0aca6;
    --border: #ddd9d4;
    --accent: #555;
    --hover: #000000;
    --panel-bg: #ffffff;
    --panel-border: #e5e2dd;
    --node-stroke: #bbb8b2;
    --node-text: #777;
    --line-color: #ccc9c3;
    --line-dash: #d5d2cd;
    --center-fill: #e85d2a;
    --year-color: #c0bdb7;
    --item-hover: #f7f5f2;
  }

  html, body {
    height: 100%;
    overflow: hidden;
    background: var(--bg);
    color: var(--fg);
    font-family: var(--font);
    -webkit-font-smoothing: antialiased;
    transition: background 0.5s var(--ease), color 0.5s var(--ease);
  }

  ::selection { background: rgba(128,128,128,0.15); }

  .layout { display: flex; height: 100%; position: relative; }

  /* ─── Graph ─── */
  .graph-area {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 1;
  }

  .graph-area svg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

  .node-group { cursor: pointer; }
  .node-group:hover .node-shape { stroke: var(--fg); }
  .node-group:hover .node-label { fill: var(--fg); }
  .node-group.active .node-shape { stroke: var(--fg); }
  .node-group.active .node-label { fill: var(--fg); }

  .node-shape {
    fill: none;
    stroke: var(--node-stroke);
    stroke-width: 1;
    transition: stroke 0.3s, fill 0.3s;
  }

  .node-shape.filled { fill: var(--node-stroke); }

  .node-label {
    font-family: var(--font);
    font-size: 11px;
    font-weight: 400;
    fill: var(--node-text);
    text-anchor: middle;
    transition: fill 0.3s;
  }

  .edge-line {
    stroke: var(--line-color);
    stroke-width: 1;
    fill: none;
    transition: stroke 0.3s;
  }

  .edge-line.dashed {
    stroke: var(--line-dash);
    stroke-dasharray: 4 4;
  }

  .center-dot {
    fill: var(--center-fill);
    cursor: pointer;
    transition: r 0.3s var(--ease);
  }

  .center-dot:hover { r: 10; }

  .center-label {
    font-family: var(--font);
    font-size: 12px;
    font-weight: 400;
    fill: var(--fg);
    text-anchor: middle;
    transition: fill 0.3s;
  }

  /* ─── Sidebar ─── */
  .sidebar {
    width: 340px;
    min-width: 340px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 2rem 0;
    position: fixed;
    right: 0;
    top: 0;
    z-index: 10;
  }

  .panel {
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: 2px;
    margin: 0 1.5rem;
    flex: 0 1 auto;
    overflow-y: auto;
    max-height: calc(100vh - 4rem);
    transition: background 0.5s var(--ease), border-color 0.5s var(--ease);
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }

  .panel::-webkit-scrollbar { width: 0; }

  .panel-section { border-bottom: 1px dashed var(--panel-border); transition: border-color 0.5s var(--ease); }
  .panel-section:last-child { border-bottom: none; }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
  }

  .section-header:hover { background: var(--item-hover); }

  .section-header-left { display: flex; align-items: center; gap: 0.6rem; }

  .section-icon {
    width: 10px; height: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px;
    color: var(--muted);
    transition: color 0.3s;
  }

  .section-icon.dot { width: 8px; height: 8px; border-radius: 50%; background: var(--center-fill); }

  .section-name {
    font-size: 0.68rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }

  .section-toggle {
    font-size: 0.75rem;
    color: var(--muted);
    font-weight: 300;
    width: 16px;
    text-align: center;
    transition: color 0.3s;
  }

  .section-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s var(--ease);
  }

  .section-content.open { max-height: 800px; }

  .section-body { padding: 0 1rem 1rem; }

  .section-desc {
    font-size: 0.62rem;
    font-weight: 300;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 1rem;
    padding-left: 0.2rem;
  }

  .section-desc i { font-style: italic; }

  .item {
    padding: 0.5rem 0;
    cursor: pointer;
    transition: padding-left 0.3s var(--ease);
  }

  .item:hover { padding-left: 0.3rem; }
  .item:hover .item-title { color: var(--hover); }

  .item.static { cursor: default; }
  .item.static:hover { padding-left: 0; }
  .item.static:hover .item-title { color: var(--fg); }

  .item-title { font-size: 0.72rem; font-weight: 400; transition: color 0.2s; }

  .item-sub {
    font-size: 0.58rem;
    font-weight: 300;
    color: var(--muted);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    margin-top: 0.05rem;
  }

  /* ─── Detail View ─── */
  .detail-view { display: none; }
  .detail-view.active { display: block; }

  .detail-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-bottom: 1px dashed var(--panel-border);
    cursor: pointer;
    transition: background 0.2s;
  }

  .detail-header:hover { background: var(--item-hover); }

  .detail-back {
    font-size: 0.68rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .detail-close { font-size: 0.75rem; color: var(--muted); cursor: pointer; }
  .detail-close:hover { color: var(--hover); }

  .detail-section-label {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.75rem 1rem;
    border-bottom: 1px dashed var(--panel-border);
  }

  .detail-section-label .section-name { font-size: 0.65rem; }

  .detail-section-close {
    margin-left: auto;
    font-size: 0.7rem;
    color: var(--muted);
    cursor: pointer;
  }

  .detail-section-close:hover { color: var(--hover); }

  .detail-body { padding: 1rem; }
  .detail-title { font-size: 0.78rem; font-weight: 400; margin-bottom: 0.15rem; }

  .detail-subtitle {
    font-size: 0.6rem;
    font-weight: 300;
    color: var(--muted);
    letter-spacing: 0.03em;
    margin-bottom: 0.8rem;
  }

  .detail-text {
    font-size: 0.65rem;
    font-weight: 300;
    color: var(--accent);
    line-height: 1.75;
  }

  .detail-connections {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-top: 1px dashed var(--panel-border);
    cursor: pointer;
    margin-top: 0.5rem;
  }

  .detail-connections:hover { background: var(--item-hover); }

  .detail-connections-left {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.62rem;
    font-weight: 400;
    color: var(--muted);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  /* ─── Gallery Overlay ─── */
  .gallery-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: var(--bg);
    z-index: 50;
    overflow-y: auto;
    transition: background 0.5s var(--ease);
  }

  .gallery-overlay.active { display: block; }

  .gallery-topbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem 1.5rem;
    z-index: 60;
    background: var(--bg);
    transition: background 0.5s var(--ease);
  }

  .gallery-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--font);
    font-size: 0.55rem;
    letter-spacing: 0.06em;
    padding: 0.3rem 0.6rem;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
  }

  .gallery-btn:hover { color: var(--hover); border-color: var(--accent); }

  .gallery-grid {
    columns: 4 280px;
    column-gap: 6px;
    padding: 4.5rem 1rem 2rem;
  }

  .gallery-grid img {
    width: 100%;
    display: block;
    margin-bottom: 6px;
    cursor: pointer;
    opacity: 0.85;
    transition: opacity 0.3s;
  }

  .gallery-grid img:hover { opacity: 1; }

  .gallery-empty {
    column-span: all;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 60vh;
    color: var(--muted);
    font-size: 0.65rem;
    font-weight: 300;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border: 1px dashed var(--border);
    border-radius: 2px;
    margin: 0 auto;
    max-width: 400px;
    gap: 0.8rem;
    cursor: pointer;
    transition: border-color 0.3s;
  }

  .gallery-empty:hover { border-color: var(--accent); }

  .gallery-empty-icon { font-size: 1.5rem; color: var(--dim); margin-bottom: 0.5rem; }
  .gallery-drop-hint { font-size: 0.55rem; color: var(--dim); }

  /* ─── Lightbox ─── */
  .lightbox {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 70;
    cursor: zoom-out;
    align-items: center;
    justify-content: center;
  }

  .lightbox.active { display: flex; }

  .lightbox img {
    max-width: 92vw;
    max-height: 92vh;
    object-fit: contain;
  }

  /* ─── Theme Toggle ─── */
  .theme-toggle {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    z-index: 100;
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--font);
    font-size: 0.55rem;
    letter-spacing: 0.06em;
    padding: 0.3rem 0.6rem;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
  }

  .theme-toggle:hover { color: var(--hover); border-color: var(--accent); }

  /* ─── Responsive ─── */
  @media (max-width: 900px) {
    .layout { flex-direction: column; }
    .graph-area { position: fixed; width: 100%; height: 100%; }
    .sidebar { width: 100%; min-width: 100%; padding: 0; position: fixed; bottom: 0; top: auto; height: auto; max-height: 55vh; overflow-y: auto; justify-content: flex-end; }
    .panel { margin: 0.5rem 1rem; max-height: none; }
    .theme-toggle { top: 0.8rem; right: 0.8rem; }
    .gallery-grid { columns: 2 150px; }
  }
</style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">Light</button>

<div class="layout">

  <div class="graph-area">
    <svg id="graph" viewBox="0 0 700 600" preserveAspectRatio="xMidYMid meet"></svg>
  </div>

  <div class="sidebar">
    <div class="panel" id="panel">

      <div id="indexView">

        <!-- INDEX -->
        <div class="panel-section">
          <div class="section-header" onclick="toggleSection('index')">
            <div class="section-header-left">
              <div class="section-icon dot"></div>
              <span class="section-name">Index</span>
            </div>
            <div class="section-toggle" id="toggle-index">&minus;</div>
          </div>
          <div class="section-content open" id="content-index">
            <div class="section-body">
              <p class="section-desc">Daniel is an entrepreneur, researcher, and polymath. His work spans venture building, biotechnology, and diverse personal pursuits &mdash; bridging innovation, curiosity, and design into cohesive systems &mdash; <a href="#" style="color:var(--fg);border-bottom:1px solid var(--border);text-decoration:none;">more information</a>.</p>
            </div>
          </div>
        </div>

        <!-- HOBBIES -->
        <div class="panel-section">
          <div class="section-header" onclick="toggleSection('hobbies')">
            <div class="section-header-left">
              <div class="section-icon" style="color:var(--muted);">&#9830;</div>
              <span class="section-name">Hobbies</span>
            </div>
            <div class="section-toggle" id="toggle-hobbies">+</div>
          </div>
          <div class="section-content" id="content-hobbies">
            <div class="section-body">
              <div class="item static"><div class="item-title">Tennis</div></div>
              <div class="item static"><div class="item-title">Piano</div></div>
              <div class="item static"><div class="item-title">Golf</div></div>
              <div class="item static"><div class="item-title">Jiu Jitsu</div></div>
              <div class="item static"><div class="item-title">Muay Thai</div></div>
              <div class="item static"><div class="item-title">Reading</div></div>
              <div class="item static"><div class="item-title">Surfing</div></div>
              <div class="item static"><div class="item-title">Sim Racing</div></div>
              <div class="item static"><div class="item-title">Watches</div></div>
              <div class="item static"><div class="item-title">Violin</div></div>
              <div class="item static"><div class="item-title">Skiing</div></div>
              <div class="item static"><div class="item-title">Chopping Wood</div></div>
            </div>
          </div>
        </div>

        <!-- VENTURES -->
        <div class="panel-section">
          <div class="section-header" onclick="toggleSection('ventures')">
            <div class="section-header-left">
              <div class="section-icon" style="color:var(--muted);">&#9650;</div>
              <span class="section-name">Ventures</span>
            </div>
            <div class="section-toggle" id="toggle-ventures">+</div>
          </div>
          <div class="section-content" id="content-ventures">
            <div class="section-body">
              <div class="item" onclick="showDetail('symbaai')">
                <div class="item-title">Symba AI</div>
              </div>
              <div class="item" onclick="showDetail('biolight')">
                <div class="item-title">BioLight</div>
              </div>
              <div class="item" onclick="showDetail('hypremium')">
                <div class="item-title">Hypremium</div>
              </div>
              <div class="item" onclick="showDetail('7feur')">
                <div class="item-title">7feur Ventures</div>
              </div>
              <div class="item" onclick="showDetail('noramp')">
                <div class="item-title">NoRamp</div>
              </div>
              <div class="item" onclick="showDetail('valkri')">
                <div class="item-title">Valkri</div>
              </div>
            </div>
          </div>
        </div>

        <!-- RESEARCH -->
        <div class="panel-section">
          <div class="section-header" onclick="toggleSection('research')">
            <div class="section-header-left">
              <div class="section-icon" style="color:var(--muted);">&#9632;</div>
              <span class="section-name">Research</span>
            </div>
            <div class="section-toggle" id="toggle-research">+</div>
          </div>
          <div class="section-content" id="content-research">
            <div class="section-body">
              <div class="item" onclick="showDetail('patent1')">
                <div class="item-title">BioLight Patent 20230012300</div>
              </div>
              <div class="item" onclick="showDetail('patent2')">
                <div class="item-title">BioLight Patent 20230010922</div>
              </div>
              <div class="item" onclick="showDetail('erc721n')">
                <div class="item-title">ERC-721N: NoRamp</div>
              </div>
            </div>
          </div>
        </div>

        <!-- WRITINGS -->
        <div class="panel-section">
          <div class="section-header" onclick="toggleSection('writings')">
            <div class="section-header-left">
              <div class="section-icon" style="color:var(--muted);">&#9671;</div>
              <span class="section-name">Writings</span>
            </div>
            <div class="section-toggle" id="toggle-writings">+</div>
          </div>
          <div class="section-content" id="content-writings">
            <div class="section-body">
              <p class="section-desc"><i>i.</i>&ensp;Coming soon.</p>
            </div>
          </div>
        </div>

        <!-- GALLERY -->
        <div class="panel-section">
          <div class="section-header" onclick="openGallery()">
            <div class="section-header-left">
              <div class="section-icon" style="color:var(--muted);">&#9679;</div>
              <span class="section-name">Gallery</span>
            </div>
            <div class="section-toggle">&rarr;</div>
          </div>
        </div>

      </div>

      <!-- Detail View -->
      <div id="detailView" class="detail-view">
        <div class="detail-header" onclick="backToIndex()">
          <div class="detail-back">
            <div class="section-icon dot"></div>
            <span>INDEX</span>
          </div>
          <div class="detail-close">&larr;</div>
        </div>
        <div class="detail-section-label">
          <div class="section-icon" id="detailSectionIcon" style="color:var(--muted);">&#9650;</div>
          <span class="section-name" id="detailSectionName">VENTURE</span>
          <div class="detail-section-close" onclick="backToIndex()">&times;</div>
        </div>
        <div class="detail-body">
          <div class="detail-title" id="detailTitle"></div>
          <div class="detail-subtitle" id="detailSubtitle"></div>
          <p class="detail-text" id="detailText"></p>
        </div>
        <div class="detail-connections" onclick="backToIndex()">
          <div class="detail-connections-left">
            <span>&#8646;</span>
            <span>Connections</span>
          </div>
          <div class="section-toggle">+</div>
        </div>
      </div>

    </div>
  </div>

</div>

<!-- Gallery Overlay -->
<div class="gallery-overlay" id="galleryOverlay">
  <div class="gallery-topbar">
    <button class="gallery-btn" onclick="closeGallery()">&larr; Back</button>
    <button class="gallery-btn" onclick="uploadImages()">+ Add</button>
  </div>
  <div class="gallery-grid" id="galleryGrid"></div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <img id="lightboxImg" src="" alt="">
</div>

<script>
// ─── Node positions (shifted left, centered around 220,300) ───
const nodes = {
  center:   { id:'center',   x:220, y:300, label:'Daniel',       type:'center' },
  info:     { id:'info',     x:250, y:218, label:'Information',  shape:'circle-filled', parent:'center' },
  hobbies:  { id:'hobbies',  x:120, y:238, label:'Hobbies',      num:'1', section:'hobbies' },
  ventures: { id:'ventures', x:330, y:242, label:'Ventures',      num:'2', section:'ventures' },
  research: { id:'research', x:335, y:378, label:'Research',      num:'3', section:'research' },
  writings: { id:'writings', x:115, y:375, label:'Writings',      num:'4', section:'writings' },
  gallery:  { id:'gallery',  x:228, y:445, label:'Gallery',       num:'5', section:'gallery' },
  tennis:   { id:'tennis',   x:45,  y:180, label:'Tennis',        shape:'diamond', parent:'hobbies' },
  piano:    { id:'piano',    x:42,  y:298, label:'Piano',         shape:'square',  parent:'hobbies' },
  symbaai:  { id:'symbaai',  x:420, y:190, label:'Symba AI',      shape:'triangle', parent:'ventures', detail:'symbaai' },
  valkri:   { id:'valkri',   x:430, y:298, label:'Valkri',        shape:'square',   parent:'ventures', detail:'valkri' },
  patent:   { id:'patent',   x:425, y:418, label:'Patent',        shape:'square',   parent:'research', detail:'patent1' },
  erc:      { id:'erc',      x:385, y:455, label:'ERC-721N',      shape:'diamond',  parent:'research', detail:'erc721n' },
  blog:     { id:'blog',     x:42,  y:430, label:'Blog',          shape:'square',   parent:'writings' },
};

const edges = [
  { from:'center', to:'hobbies',  type:'solid' },
  { from:'center', to:'ventures', type:'solid' },
  { from:'center', to:'research', type:'solid' },
  { from:'center', to:'writings', type:'solid' },
  { from:'center', to:'gallery',  type:'solid' },
  { from:'center', to:'info',     type:'solid' },
  { from:'hobbies',  to:'tennis',   type:'dashed' },
  { from:'hobbies',  to:'piano',    type:'dashed' },
  { from:'ventures', to:'symbaai',  type:'dashed' },
  { from:'ventures', to:'valkri',   type:'dashed' },
  { from:'research', to:'patent',   type:'dashed' },
  { from:'research', to:'erc',      type:'dashed' },
  { from:'writings', to:'blog',     type:'dashed' },
];

const details = {
  symbaai:  { section:'VENTURE',  icon:'\u25B2', title:'Symba AI',                   subtitle:'Artificial Intelligence',                text:'An AI-focused venture building intelligent systems and automation tools.' },
  biolight: { section:'VENTURE',  icon:'\u25B2', title:'BioLight',                    subtitle:'Biotechnology',                          text:'A biotechnology company developing novel light-based therapeutic solutions, backed by multiple patents.' },
  hypremium:{ section:'VENTURE',  icon:'\u25B2', title:'Hypremium',                   subtitle:'Premium Products & Services',            text:'A premium brand and product venture.' },
  '7feur':  { section:'VENTURE',  icon:'\u25B2', title:'7feur Ventures',              subtitle:'Venture Building',                       text:'A venture studio and holding company focused on building and scaling technology companies.' },
  noramp:   { section:'VENTURE',  icon:'\u25B2', title:'NoRamp',                      subtitle:'Web3 Infrastructure',                    text:'Web3 infrastructure simplifying NFT minting and distribution through the ERC-721N standard.' },
  valkri:   { section:'VENTURE',  icon:'\u25B2', title:'Valkri',                      subtitle:'AI-Powered Algorithmic Hedge Fund',      text:'An AI-driven quantitative hedge fund deploying algorithmic trading strategies. Built on proprietary machine learning models for market prediction and execution.' },
  patent1:  { section:'RESEARCH', icon:'\u25A0', title:'BioLight Patent 20230012300',  subtitle:'US Patent Application',                  text:'Patent application covering novel methods and apparatus for light-based therapeutic interventions in biological systems.' },
  patent2:  { section:'RESEARCH', icon:'\u25A0', title:'BioLight Patent 20230010922',  subtitle:'US Patent Application',                  text:'Patent application covering additional innovations in photobiomodulation technology and delivery mechanisms.' },
  erc721n:  { section:'RESEARCH', icon:'\u25A0', title:'ERC-721N: NoRamp',             subtitle:'Ethereum Token Standard',                text:'A novel ERC-721 extension designed to eliminate friction in NFT minting, enabling gasless and rampless distribution at scale.' },
};

// ─── Render (animated) ───
const svg = document.getElementById('graph');
const ns = 'http://www.w3.org/2000/svg';

function el(tag, attrs) {
  const e = document.createElementNS(ns, tag);
  for (const [k,v] of Object.entries(attrs)) e.setAttribute(k, v);
  return e;
}

Object.values(nodes).forEach(n => {
  n.baseX = n.x;
  n.baseY = n.y;
  n.driftAmpX = 3 + Math.random() * 8;
  n.driftAmpY = 3 + Math.random() * 8;
  n.driftSpeedX = 0.3 + Math.random() * 0.6;
  n.driftSpeedY = 0.3 + Math.random() * 0.6;
  n.driftPhaseX = Math.random() * Math.PI * 2;
  n.driftPhaseY = Math.random() * Math.PI * 2;
});

const edgeEls = edges.map(e => {
  const line = el('line', { x1:0, y1:0, x2:0, y2:0, class:'edge-line' + (e.type==='dashed'?' dashed':'') });
  svg.appendChild(line);
  return { def: e, el: line };
});

const nodeEls = {};
Object.values(nodes).forEach(n => {
  if (n.type === 'center') {
    const g = el('g', { 'data-node': n.id });
    const dot = el('circle', { cx:0, cy:0, r:8, class:'center-dot' });
    dot.onclick = () => backToIndex();
    g.appendChild(dot);
    const lbl = el('text', { x:0, y:24, class:'center-label' });
    lbl.textContent = n.label;
    g.appendChild(lbl);
    svg.appendChild(g);
    nodeEls[n.id] = { group: g, node: n };
    return;
  }

  const g = el('g', { class:'node-group', 'data-node':n.id });

  if (n.num) {
    g.appendChild(el('circle', { cx:0, cy:0, r:12, class:'node-shape' }));
    const num = el('text', { x:0, y:3.5, class:'node-label', 'text-anchor':'middle', 'font-size':'9' });
    num.textContent = n.num;
    g.appendChild(num);
  } else if (n.shape === 'triangle') {
    const s = 10;
    g.appendChild(el('polygon', { points:`0,${-s} ${-s},${s*0.7} ${s},${s*0.7}`, class:'node-shape' }));
  } else if (n.shape === 'square') {
    const s = 9;
    g.appendChild(el('rect', { x:-s, y:-s, width:s*2, height:s*2, class:'node-shape' }));
  } else if (n.shape === 'diamond') {
    const s = 10;
    g.appendChild(el('polygon', { points:`0,${-s} ${s},0 0,${s} ${-s},0`, class:'node-shape' }));
  } else if (n.shape === 'circle-filled') {
    g.appendChild(el('circle', { cx:0, cy:0, r:6, class:'node-shape filled' }));
  }

  const ly = n.num ? 28 : (n.shape==='triangle' ? 24 : 22);
  const lbl = el('text', { x:0, y:ly, class:'node-label' });
  lbl.textContent = n.label;
  g.appendChild(lbl);

  g.onclick = () => {
    document.querySelectorAll('.node-group').forEach(e => e.classList.remove('active'));
    g.classList.add('active');
    if (n.id === 'gallery') { openGallery(); return; }
    if (n.section) toggleSection(n.section, true);
    else if (n.detail) showDetail(n.detail);
  };

  svg.appendChild(g);
  nodeEls[n.id] = { group: g, node: n };
});

// ─── Mouse tracking ───
let mouseX = -1000, mouseY = -1000;
const graphArea = document.querySelector('.graph-area');

graphArea.addEventListener('mousemove', e => {
  const rect = svg.getBoundingClientRect();
  mouseX = ((e.clientX - rect.left) / rect.width) * 700;
  mouseY = ((e.clientY - rect.top) / rect.height) * 600;
});

graphArea.addEventListener('mouseleave', () => { mouseX = -1000; mouseY = -1000; });

// ─── Animation loop ───
function animate(time) {
  const t = time * 0.001;

  Object.values(nodes).forEach(n => {
    let dx = Math.sin(t * n.driftSpeedX + n.driftPhaseX) * n.driftAmpX;
    let dy = Math.cos(t * n.driftSpeedY + n.driftPhaseY) * n.driftAmpY;
    dx += Math.sin(t * n.driftSpeedX * 0.4 + n.driftPhaseY) * n.driftAmpX * 0.5;
    dy += Math.cos(t * n.driftSpeedY * 0.3 + n.driftPhaseX) * n.driftAmpY * 0.5;

    const mx = n.baseX + dx - mouseX;
    const my = n.baseY + dy - mouseY;
    const dist = Math.sqrt(mx * mx + my * my);
    if (dist < 120 && dist > 0) {
      const force = (1 - dist / 120) * 25;
      dx += (mx / dist) * force;
      dy += (my / dist) * force;
    }

    n.x = n.baseX + dx;
    n.y = n.baseY + dy;
  });

  Object.values(nodeEls).forEach(({ group, node }) => {
    group.setAttribute('transform', `translate(${node.x}, ${node.y})`);
  });

  edgeEls.forEach(({ def, el }) => {
    const f = nodes[def.from], t = nodes[def.to];
    el.setAttribute('x1', f.x); el.setAttribute('y1', f.y);
    el.setAttribute('x2', t.x); el.setAttribute('y2', t.y);
  });

  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

// ─── Sidebar Logic ───
function toggleSection(id, forceOpen) {
  const content = document.getElementById('content-' + id);
  const toggle = document.getElementById('toggle-' + id);
  if (!content) return;
  if (forceOpen || !content.classList.contains('open')) {
    content.classList.add('open');
    if (toggle) toggle.textContent = '\u2212';
  } else {
    content.classList.remove('open');
    if (toggle) toggle.textContent = '+';
  }
}

function showDetail(id) {
  const d = details[id];
  if (!d) return;
  document.getElementById('indexView').style.display = 'none';
  document.getElementById('detailView').classList.add('active');
  document.getElementById('detailSectionIcon').textContent = d.icon;
  document.getElementById('detailSectionName').textContent = d.section;
  document.getElementById('detailTitle').textContent = d.title;
  document.getElementById('detailSubtitle').textContent = d.subtitle;
  document.getElementById('detailText').textContent = d.text;
}

function backToIndex() {
  document.getElementById('indexView').style.display = 'block';
  document.getElementById('detailView').classList.remove('active');
  document.querySelectorAll('.node-group').forEach(e => e.classList.remove('active'));
}

function toggleTheme() {
  const html = document.documentElement;
  const btn = document.getElementById('themeBtn');
  if (html.getAttribute('data-theme') === 'dark') {
    html.setAttribute('data-theme', 'light');
    btn.textContent = 'Dark';
  } else {
    html.setAttribute('data-theme', 'dark');
    btn.textContent = 'Light';
  }
}

// ─── Gallery ───
function openGallery() {
  document.getElementById('galleryOverlay').classList.add('active');
  renderGallery();
}

function closeGallery() {
  document.getElementById('galleryOverlay').classList.remove('active');
}

function renderGallery() {
  const grid = document.getElementById('galleryGrid');
  grid.innerHTML = '';
  const stored = JSON.parse(localStorage.getItem('galleryImages') || '[]');

  if (stored.length === 0) {
    grid.innerHTML = '<div class="gallery-empty" onclick="uploadImages()"><div class="gallery-empty-icon">+</div><div>Drop images here</div><div class="gallery-drop-hint">or click to browse</div></div>';
    return;
  }

  stored.forEach(img => {
    const imgEl = document.createElement('img');
    imgEl.src = img.src;
    imgEl.alt = img.alt || '';
    imgEl.onclick = () => openLightbox(img.src);
    grid.appendChild(imgEl);
  });
}

function openLightbox(src) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightbox').classList.add('active');
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
}

const galleryOverlay = document.getElementById('galleryOverlay');
galleryOverlay.addEventListener('dragover', e => { e.preventDefault(); e.stopPropagation(); });
galleryOverlay.addEventListener('drop', e => { e.preventDefault(); e.stopPropagation(); handleFiles(e.dataTransfer.files); });

function handleFiles(files) {
  const stored = JSON.parse(localStorage.getItem('galleryImages') || '[]');
  Array.from(files).forEach(file => {
    if (!file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = ev => {
      stored.push({ src: ev.target.result, alt: file.name });
      localStorage.setItem('galleryImages', JSON.stringify(stored));
      renderGallery();
    };
    reader.readAsDataURL(file);
  });
}

function uploadImages() {
  const input = document.createElement('input');
  input.type = 'file';
  input.multiple = true;
  input.accept = 'image/*';
  input.onchange = () => handleFiles(input.files);
  input.click();
}
</script>

</body>
</html>
